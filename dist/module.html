<div style="width: 100%; height: 100%; overflow: auto">
    <img style="position: absolute; bottom: 0px" ng-show="ctrl.isLoading" src="/public/img/loading.gif">

    <div ng-show="ctrl.showHistogram" style="position: fixed; width: 1700px; height: 700px; left: 90px; top: 150px; z-index: 999; 
        background-color: white; padding:5px; border: 1px solid black; overflow: scroll;">
        <button ng-click="ctrl.closeHistogram()">
            Close
        </button>


        <br>

        <canvas id="histogramCanvas" width="9999" height="600"
            style="margin-top: 10px; cursor: {{ctrl.histogramCursor}}" ng-mousemove="ctrl.moveMouseOnHistogram($event)"
            ng-mousedown="ctrl.mouseDownOnHistogram($event)" ng-mouseUp="ctrl.mouseUpOnHistogram($event)"></canvas>
    </div>

    <!-- Viewing settings -->
    <table>
        <tr>
            <!-- Grouping mode -->
            <td>
                <div class="input-box">
                    <table>
                        <tr>
                            <td>
                                Grouping mode
                            </td>

                            <td class="leftPaddingCell">
                                <select ng-model="ctrl.groupingMode" ng-change="ctrl.selectGroupingMode()"
                                    style="width: 150px">
                                    <option value="1">Single-attribute</option>
                                    <option value="2">Multi-attribute</option>
                                </select>
                            </td>
                        </tr>
                    </table>
                </div>
            </td>

            <td ng-show="ctrl.isGrouped" class="leftPaddingCell">
                <div class="input-box">
                    <table>
                        <tr>
                            <td>
                                Grouping threshold
                            </td>

                            <td class="leftPaddingCell">
                                <input type="range" min="0" max="{{ctrl.config.groupingThresholdCount}}"
                                    style="width: 200px" ng-model="ctrl.groupingThreshold"
                                    ng-change="ctrl.changeGroupingThreshold()">
                            </td>

                            <td class="leftPaddingCell">
                                <span style="font-style: italic">
                                    {{ctrl.groupingThreshold}}
                                </span>
                            </td>
                        </tr>
                    </table>
                </div>
            </td>

            <td class="leftPaddingCell">
                <button ng-click="ctrl.groupUngroup()"
                    style="width:70px">{{ctrl.isGrouped ? "Ungroup" : "Group"}}</button>
            </td>

            <td ng-show="ctrl.showMergeSelectedGroups" class="leftPaddingCell">
                <button ng-click="ctrl.mergeSelectedGroups()">Merge selected groups</button>
            </td>

            <!-- Time highlight mode -->
            <td ng-show="ctrl.isGrouped" class="leftPaddingCell">
                <div class="input-box">
                    <table>
                        <tr>
                            <td>
                                Time highlight mode
                            </td>

                            <td class="leftPaddingCell">
                                <select ng-model="ctrl.timeHighlightMode" ng-change="ctrl.selectTimeHighlightMode()"
                                    style="width: 100px">
                                    <option value="1">Point</option>
                                    <option value="2">Range</option>
                                </select>
                            </td>
                        </tr>
                    </table>
                </div>
            </td>

            <td class="leftPaddingCell">
                <button ng-click="ctrl.compressDecompress()"
                    style="width:120px">{{ctrl.isCompressed ? "Decompress" : "Compress"}} time</button>
            </td>
        </tr>
    </table>

    <!-- Overview graph & focus area -->
    <div style="position: relative; margin-top: 10px">
        <canvas id="overviewCanvas" style="position: absolute" width="{{ctrl.overviewCanvasWidth}}"
            height="{{ctrl.overviewCanvasHeight}}"></canvas>

        <canvas id="overviewTimeIndicatorCanvas" style="position: absolute" width="{{ctrl.overviewCanvasWidth}}"
            height="{{ctrl.overviewCanvasHeight}}"></canvas>

        <canvas id="focusAreaCanvas" style="position: absolute; cursor: {{ctrl.overviewCursor}}"
            width="{{ctrl.overviewCanvasWidth}}" height="{{ctrl.overviewCanvasHeight}}"
            ng-mousemove="ctrl.moveMouseOnOverview($event)" ng-mousedown="ctrl.mouseDownOnOverview($event)"
            ng-mouseUp="ctrl.mouseUpOnOverView($event)"></canvas>
    </div>

    <!-- Focus graph -->
    <div ng-show="ctrl.showFocus" style="margin-top: {{ctrl.focusGraphMarginTop}}px">
        <div ng-hide="ctrl.isGrouped"
            style="font-family: Arial; font-style: italic;  font-size: {{ctrl.timeFontSize}}px">
            <span style="margin-left: {{ctrl.fromDateLeftMargin}}px">{{ctrl.focusedFromDate}}</span>
            <span style="margin-left: {{ctrl.toDateLeftMargin}}px">{{ctrl.focusedToDate}}</span>
        </div>

        <div id="focusGraphContainer" style="height: 400px; overflow: auto">
            <!-- Grouped -->
            <div ng-if="ctrl.isGrouped">
                <div ng-repeat="group in ctrl.focusModel.groupList">
                    <div ng-repeat="instance in group.instanceList" ng-show="$index == 0 || group.showDetails"
                        ng-mouseover="ctrl.moveMouseOnFocusGroup(group, instance)"
                        ng-mouseleave="ctrl.stopOverviewMarkerInterval()"
                        style="border-bottom: 1px {{group.showDetails && $index < group.instanceList.length - 1 ? 'dashed' : 'solid'}} black; padding-bottom: 5px">
                        <table id="focusGraphRow">
                            <tr>
                                <td class="focusInstanceCell centeredCell">
                                    <canvas id="focusGroupMarkerCanvas-{{$parent.$index}}-{{$index}}"
                                        width="{{ctrl.focusGraphMarkerWidth}}"
                                        height="{{ctrl.focusGraphMarkerHeight}}"></canvas>
                                </td>

                                <td ng-class="{focusInstanceCell : true, centeredCell: true, highlighted: instance.isSelected}"
                                    style="line-height: 100%; text-align: center">
                                    <div ng-show="group.showDetails">
                                        {{instance.instance}}
                                    </div>

                                    <!-- First instance -->
                                    <div ng-show="$index == 0 && !group.showDetails">
                                        <div>
                                            Group {{($parent.$index + 1)}}
                                        </div>

                                        <div>
                                            ({{group.instanceList.length}}
                                            node{{group.instanceList.length > 1 ? "s" : ""}})
                                        </div>
                                    </div>

                                    <span ng-click="ctrl.showNodes(group, $event)" style="color: blue; cursor: pointer">
                                        {{group.showDetails ? "hide" : "show"}} details
                                    </span>
                                </td>

                                <td id="canvasCell" class="focusCanvasCell">
                                    <div style="border-bottom: 1px dotted black">
                                        <canvas id="focusGraphCanvas-{{$parent.$index}}-{{$index}}"
                                            width="{{ctrl.focusGraphWidth}}" height="{{ctrl.focusGraphHeight}}"
                                            ng-click="ctrl.selectGroup(instance, $event, $parent.$index, $index)"></canvas>
                                    </div>
                                </td>
                            </tr>

                            <tr
                                ng-show="group.overviewGroup.timeRangeIndexList && group.overviewGroup.timeRangeIndexList.length > 0">
                                <td colspan="2" style="text-align: right; padding-right: 10px">
                                    from

                                    <b>
                                        {{group.overviewGroup.startTimeRangeDate}}
                                    </b>

                                    to

                                    <b>
                                        {{group.overviewGroup.endTimeRangeDate}}
                                    </b>
                                </td>

                                <td>
                                    <canvas id="focusGraphHighlightedTimeRangeCanvas-{{$parent.$index}}-{{$index}}"
                                        style="margin-top: 5px" width="{{ctrl.focusGraphWidth}}"
                                        height="{{ctrl.focusGraphHeight}}"></canvas>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Ungrouped -->
            <div ng-if="!ctrl.isGrouped">
                <div ng-repeat="x in [].constructor(ctrl.focusModel.data.length) track by $index"
                    style="border-bottom:1px solid black; padding-top: 5px" ng-click="ctrl.selectNode($index, $event)">
                    <table>
                        <tr id="focusGraphRow">
                            <td
                                ng-class="{focusInstanceCell : true, centeredCell: true, highlighted: ctrl.focusModel.data[$index].isSelected || group.showDetails}">
                                {{ctrl.focusModel.data[$index].instance}}
                            </td>

                            <td id="canvasCell" class="focusCanvasCell">
                                <canvas id="focusGraphCanvas-{{$index}}" width="{{ctrl.focusGraphWidth}}"
                                    height="{{ctrl.focusGraphHeight}}"></canvas>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    </div>